name: Build and Upload Firefox Extension

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install web-ext
      run: npm install --global web-ext

    - name: Zip Firefox extension
      run: |
        zip -r firefox-extension.zip \
          assets/* \
          js/* \
          pub/* \
          res/* \
          LICENSE \
          README.md \
          manifest.json

    - name: Sign and Upload extension to AMO
      run: |
        web-ext sign --source-dir . \
          --api-key ${{ secrets.AMO_API_KEY }} \
          --api-secret ${{ secrets.AMO_API_SECRET }} \
          --id "fmhy-safeguard"
      env:
        AMO_API_KEY: ${{ secrets.AMO_API_KEY }}
        AMO_API_SECRET: ${{ secrets.AMO_API_SECRET }}

    - name: Notify about successful release
      run: echo "Firefox extension uploaded successfully!"
